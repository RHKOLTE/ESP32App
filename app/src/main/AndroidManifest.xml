<?xml version="1.0" encoding="utf-8"?>
<!--
    The AndroidManifest.xml file is the main configuration file for an Android application.
    It describes the application's components (activities, services, broadcast receivers, and content providers),
    declares the permissions the app requires, and specifies other essential information about the app.
-->
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <!--
        Declares the permissions required by the application.
    -->

    <!-- Allows the app to keep the processor from sleeping or the screen from dimming. -->
    <uses-permission android:name="android.permission.WAKE_LOCK" />

    <!-- Allows the app to control the device's power state. This is a powerful permission and should be used with caution. -->
    <uses-permission android:name="android.permission.DEVICE_POWER" tools:ignore="ProtectedPermissions" />

    <!-- Allows the app to request permission to access USB devices. -->
    <uses-permission android:name="android.permission.USB_PERMISSION" />

    <!--
        Declares that the application uses a hardware feature.
        In this case, it indicates that the app requires the device to have USB host capabilities.
    -->
    <uses-feature android:name="android.hardware.usb.host" />

    <!-- Allows the app to run as a foreground service, which is a service that the user is actively aware of. -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE" />

    <!-- Allows the app to post notifications. Required for apps targeting Android 13 (API 33) and higher. -->
    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />

    <!--
        Allows a foreground service to access connected devices (like USB).
        This is a more specific foreground service permission introduced in Android 13.
    -->
    <uses-permission android:name="android.permission.FOREGROUND_SERVICE_CONNECTED_DEVICE" />

    <!--
        The main application tag. All application components are defined within this tag.

        Attributes:
        - android:allowBackup: Enables or disables Auto Backup for the application.
        - android:dataExtractionRules: Specifies the rules for data extraction during backup and restore (for API 31+).
        - android:fullBackupContent: Specifies the rules for Auto Backup (for API 30 and below).
        - android:icon: The application's icon.
        - android:label: The application's user-friendly name.
        - android:roundIcon: The application's round icon, used in launchers that support it.
        - android:supportsRtl: Declares whether the app supports right-to-left (RTL) layouts.
        - android:theme: The default theme for all activities in the application.
    -->
    <application
        android:allowBackup="true"
        android:dataExtractionRules="@xml/data_extraction_rules"
        android:fullBackupContent="@xml/backup_rules"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.ESP32App">

        <!--
            Declares the main activity of the application.

            Attributes:
            - android:name: The class name of the activity.
            - android:exported: Whether the activity can be launched by components of other applications.
            - android:label: A user-friendly label for the activity.
            - android:theme: A specific theme for this activity.
            - android:keepScreenOn: Prevents the screen from turning off while this activity is in the foreground.
        -->
        <activity
            android:name=".MainActivity"
            android:exported="true"
            android:label="@string/app_name"
            android:theme="@style/Theme.ESP32App"
            android:keepScreenOn="true">

            <!--
                An intent filter specifies the types of intents that an activity, service, or broadcast receiver can respond to.
                This intent filter declares that the MainActivity is the main entry point of the application
                and should be listed in the application launcher.
            -->
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>

        <!--
            Declares a service component.

            Attributes:
            - android:name: The class name of the service.
            - android:foregroundServiceType: The type of foreground service. In this case, it's for a connected device.
        -->
        <service android:name=".SerialService" android:foregroundServiceType="connectedDevice" />

        <!--
            Declares a content provider component.
            FileProvider is used to securely share files with other apps.

            Attributes:
            - android:name: The class name of the provider.
            - android:authorities: A list of URI authorities that the content provider handles.
            - android:exported: Whether the provider can be used by other applications.
            - android:grantUriPermissions: Whether temporary permission can be granted to other apps to access the provider's data.
        -->
        <provider
            android:name="androidx.core.content.FileProvider"
            android:authorities="${applicationId}.provider"
            android:exported="false"
            android:grantUriPermissions="true">
            <!--
                Meta-data for the FileProvider, specifying the paths that can be shared.
            -->
            <meta-data
                android:name="android.support.FILE_PROVIDER_PATHS"
                android:resource="@xml/provider_paths" />
        </provider>
    </application>

</manifest>